
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Chapter10 · 我的代码手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="胡朕豪">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="chapter11.html" />
    
    
    <link rel="prev" href="chapter09.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Linux
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../Linux/常用命令.html">
            
                <a href="../../Linux/常用命令.html">
            
                    
                    Linux常用命令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    计算机基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../403/数据结构.html">
            
                <a href="../../403/数据结构.html">
            
                    
                    数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../403/算法模板.html">
            
                <a href="../../403/算法模板.html">
            
                    
                    算法模板
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    技能树
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../技能树/阅读笔记.html">
            
                <a href="../../技能树/阅读笔记.html">
            
                    
                    阅读笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../技能树/git.html">
            
                <a href="../../技能树/git.html">
            
                    
                    Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../技能树/踩坑.html">
            
                <a href="../../技能树/踩坑.html">
            
                    
                    踩坑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../技能树/Docker.html">
            
                <a href="../../技能树/Docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../技能树/工具.html">
            
                <a href="../../技能树/工具.html">
            
                    
                    工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../../技能树/kafka.html">
            
                <a href="../../技能树/kafka.html">
            
                    
                    Kafka
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Java
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../基础.html">
            
                <a href="../基础.html">
            
                    
                    基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                    SpringBoot+Vue开发实战笔记
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="chapter01.html">
            
                <a href="chapter01.html">
            
                    
                    Chapter01
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="chapter02.html">
            
                <a href="chapter02.html">
            
                    
                    Chapter02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="chapter03.html">
            
                <a href="chapter03.html">
            
                    
                    Chapter03
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="chapter04.html">
            
                <a href="chapter04.html">
            
                    
                    Chapter04
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="chapter05.html">
            
                <a href="chapter05.html">
            
                    
                    Chapter05
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="chapter06.html">
            
                <a href="chapter06.html">
            
                    
                    Chapter06
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="chapter07.html">
            
                <a href="chapter07.html">
            
                    
                    Chapter07
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.8" data-path="chapter08.html">
            
                <a href="chapter08.html">
            
                    
                    Chapter08
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.9" data-path="chapter09.html">
            
                <a href="chapter09.html">
            
                    
                    Chapter09
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.2.10" data-path="chapter10.html">
            
                <a href="chapter10.html">
            
                    
                    Chapter10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.11" data-path="chapter11.html">
            
                <a href="chapter11.html">
            
                    
                    Chapter11
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.12" data-path="chapter12.html">
            
                <a href="chapter12.html">
            
                    
                    Chapter12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.13" data-path="chapter13.html">
            
                <a href="chapter13.html">
            
                    
                    Chapter13
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../代码段.html">
            
                <a href="../代码段.html">
            
                    
                    代码段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Python
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../Python/基础.html">
            
                <a href="../../Python/基础.html">
            
                    
                    Python基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../Python/数据库.html">
            
                <a href="../../Python/数据库.html">
            
                    
                    数据库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    前端
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../前端/HTML.html">
            
                <a href="../../前端/HTML.html">
            
                    
                    HTML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    数据库
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../数据库/HiveSQL.html">
            
                <a href="../../数据库/HiveSQL.html">
            
                    
                    HiveSQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../数据库/MySQL.html">
            
                <a href="../../数据库/MySQL.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../数据库/Redis.html">
            
                <a href="../../数据库/Redis.html">
            
                    
                    Redis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Chapter10</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x7B2C;&#x5341;&#x7AE0;-spring-boot-&#x5B89;&#x5168;&#x7BA1;&#x7406;">&#x7B2C;&#x5341;&#x7AE0; Spring Boot &#x5B89;&#x5168;&#x7BA1;&#x7406;</h1>
<h2 id="101-spring-security-&#x7684;&#x57FA;&#x672C;&#x914D;&#x7F6E;">10.1 Spring Security &#x7684;&#x57FA;&#x672C;&#x914D;&#x7F6E;</h2>
<h3 id="1011-&#x57FA;&#x672C;&#x7528;&#x6CD5;">10.1.1 &#x57FA;&#x672C;&#x7528;&#x6CD5;</h3>
<h4 id="&#x4F9D;&#x8D56;">&#x4F9D;&#x8D56;</h4>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 id="&#x63A5;&#x53E3;">&#x63A5;&#x53E3;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;
    }
}
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h4>
<p>&#x8BBF;&#x95EE;&#xFF1A;<a href="http://localhost:8080/hello" target="_blank">http://localhost:8080/hello</a> &#x81EA;&#x52A8;&#x8DF3;&#x8F6C;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;</p>
<p><img src="chapter10/image-20201208090339758.png" alt="image-20201208090339758"></p>
<p>&#x9ED8;&#x8BA4;&#x8D26;&#x6237;&#xFF1A;user &#xFF0C; &#x5BC6;&#x7801;&#xFF1A;<img src="chapter10/image-20201208090622108.png" alt="image-20201208090622108"></p>
<p>&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#x8DF3;&#x8F6C;&#x5230;&#x8BBF;&#x95EE;&#x9875;&#x3002;</p>
<h3 id="1012-&#x914D;&#x7F6E;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;">10.1.2 &#x914D;&#x7F6E;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;</h3>
<pre><code class="lang-properties">spring.security.user.name=ihao
spring.security.user.password=123456
spring.security.user.roles=admin
</code></pre>
<h3 id="1013-&#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x8BA4;&#x8BC1;">10.1.3 &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x8BA4;&#x8BC1;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.inMemoryAuthentication()
                .withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;ihao&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>);
    }
}
</code></pre>
<h3 id="1014-httpsecurity">10.1.4 HttpSecurity</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.inMemoryAuthentication()
                .withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;DBA&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;ihao&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        http.authorizeRequests()
                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>)
                .hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>)
                .access(<span class="hljs-string">&quot;hasAnyRole(&apos;ADMIN&apos;, &apos;USER&apos;)&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/db/**&quot;</span>)
                .access(<span class="hljs-string">&quot;hasRole(&apos;ADMIN&apos;) and hasRole(&apos;DBA&apos;)&quot;</span>)
                .anyRequest()
                .authenticated()
                .and()
                .formLogin()
                .loginProcessingUrl(<span class="hljs-string">&quot;/login&quot;</span>)
                .permitAll()
                .and()
                .csrf()
                .disable();
    }
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/db/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dba</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello dba!&quot;</span>;
    }
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/admin/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello admin!&quot;</span>;
    }
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/user/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello user!&quot;</span>;
    }
}
</code></pre>
<p>&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x8D26;&#x6237;&#x767B;&#x5F55;&#xFF0C;&#x4F1A;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;</p>
<h3 id="1015-&#x767B;&#x5F55;&#x8868;&#x5355;&#x8BE6;&#x7EC6;&#x914D;&#x7F6E;">10.1.5 &#x767B;&#x5F55;&#x8868;&#x5355;&#x8BE6;&#x7EC6;&#x914D;&#x7F6E;</h3>
<h4 id="&#x4EE3;&#x7801;">&#x4EE3;&#x7801;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.inMemoryAuthentication()
                .withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;DBA&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;ihao&quot;</span>).password(<span class="hljs-string">&quot;123456&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>);
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        http.authorizeRequests()
                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>)
                .hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>)
                .access(<span class="hljs-string">&quot;hasAnyRole(&apos;ADMIN&apos;, &apos;USER&apos;)&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/db/**&quot;</span>)
                .access(<span class="hljs-string">&quot;hasRole(&apos;ADMIN&apos;) and hasRole(&apos;DBA&apos;)&quot;</span>)
                .anyRequest()
                .authenticated()
                .and()
                .formLogin()
                .loginPage(<span class="hljs-string">&quot;/login_page.html&quot;</span>)
                .loginProcessingUrl(<span class="hljs-string">&quot;/login&quot;</span>)
                .usernameParameter(<span class="hljs-string">&quot;name&quot;</span>)
                .passwordParameter(<span class="hljs-string">&quot;passwd&quot;</span>)
                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
                        Object principal = authentication.getPrincipal();
                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                        PrintWriter out = httpServletResponse.getWriter();
                        httpServletResponse.setStatus(<span class="hljs-number">200</span>);
                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">200</span>);
                        map.put(<span class="hljs-string">&quot;msg&quot;</span>, principal);
                        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();
                        out.write(om.writeValueAsString(map));
                        out.flush();
                        out.close();
                    }
                })
                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                        PrintWriter out = httpServletResponse.getWriter();
                        httpServletResponse.setStatus(<span class="hljs-number">401</span>);
                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">401</span>);
                        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> LockedException) {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x8D26;&#x6237;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> BadCredentialsException) {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x8D26;&#x6237;&#x540D;&#x6216;&#x5BC6;&#x7801;&#x8F93;&#x5165;&#x9519;&#x8BEF;&#xFF0C;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> DisabledException) {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x8D26;&#x6237;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> AccountExpiredException) {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x8D26;&#x6237;&#x5DF2;&#x8FC7;&#x671F;&#xFF0C;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x5BC6;&#x7801;&#x5DF2;&#x8FC7;&#x671F;&#xFF0C;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        } <span class="hljs-keyword">else</span> {
                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;&#x767B;&#x5F55;&#x5931;&#x8D25;&quot;</span>);
                        }
                        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();
                        out.write(om.writeValueAsString(map));
                        out.flush();
                        out.close();
                    }
                })
                .permitAll()
                .and()
                .csrf()
                .disable();
    }
}
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h4>
<p><img src="chapter10/image-20201212201255835.png" alt="image-20201212201255835"></p>
<p><img src="chapter10/image-20201212201219142.png" alt="image-20201212201219142"></p>
<h3 id="1017-&#x6CE8;&#x9500;&#x767B;&#x5F55;&#x914D;&#x7F6E;">10.1.7 &#x6CE8;&#x9500;&#x767B;&#x5F55;&#x914D;&#x7F6E;</h3>
<pre><code class="lang-java">.and()
    .logout()
    .logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>)
    .clearAuthentication(<span class="hljs-keyword">true</span>)
    .invalidateHttpSession(<span class="hljs-keyword">true</span>)
    .addLogoutHandler(<span class="hljs-keyword">new</span> LogoutHandler() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">logout</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> </span>{

        }
    })
    .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
            httpServletResponse.sendRedirect(<span class="hljs-string">&quot;/login_page&quot;</span>);
        }
    })
</code></pre>
<h3 id="1018-&#x5BC6;&#x7801;&#x52A0;&#x5BC6;">10.1.8 &#x5BC6;&#x7801;&#x52A0;&#x5BC6;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">10</span>);
}
</code></pre>
<p>&#x751F;&#x6210;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x5BC6;&#x7801;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
    BCryptPasswordEncoder bCryptPasswordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        String password = <span class="hljs-string">&quot;123456&quot;</span>;
        String hashed = bCryptPasswordEncoder.encode(password);
        System.out.println(hashed);
    }
}
</code></pre>
<p>&#x914D;&#x7F6E;&#x5230;&#x914D;&#x7F6E;&#x4EE3;&#x7801;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    auth.inMemoryAuthentication()
        .withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$u/l5bdTLrfC1v8wimLFgpuEdmxg.gpePiGkgqo1xgdZYGJ329.bN6&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;DBA&quot;</span>)
        .and()
        .withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$i/7kJguZi./hcLycAoG56.4YZ3VuU9AYgb8K98QZihKTyi32IfXSi&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>)
        .and()
        .withUser(<span class="hljs-string">&quot;ihao&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$GHLUkkMBQNbpexWBNsH9MeCFXQllb5jYSAaRYD/6R9X0v7Z0DqQk.&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>);
}
</code></pre>
<h3 id="1019-&#x65B9;&#x6CD5;&#x5B89;&#x5168;">10.1.9 &#x65B9;&#x6CD5;&#x5B89;&#x5168;</h3>
<h4 id="&#x914D;&#x7F6E;">&#x914D;&#x7F6E;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="hljs-keyword">true</span>, securedEnabled = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> </span>{
}
<span class="hljs-comment">// MyWebSecurityConfig.configure() &#x65B9;&#x6CD5;&#x6CE8;&#x5C04;&#x6389;</span>
</code></pre>
<h4 id="&#x670D;&#x52A1;">&#x670D;&#x52A1;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MethodService</span> </span>{
    <span class="hljs-meta">@Secured</span>(<span class="hljs-string">&quot;ROLE_DBA&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dba</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello dba!&quot;</span>;
    }

    <span class="hljs-meta">@PreAuthorize</span>(<span class="hljs-string">&quot;hasRole(&apos;ADMIN&apos;) or hasRole(&apos;DBA&apos;)&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello admin!&quot;</span>;
    }

    <span class="hljs-meta">@PreAuthorize</span>(<span class="hljs-string">&quot;hasAnyRole(&apos;ADMIN&apos;, &apos;DBA&apos;, &apos;USER&apos;)&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello user!&quot;</span>;
    }
}
</code></pre>
<h4 id="&#x63A7;&#x5236;&#x5C42;">&#x63A7;&#x5236;&#x5C42;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    MethodService methodService;
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/db/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dba</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> methodService.dba();
    }
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/admin/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> methodService.admin();
    }
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/user/hello&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> methodService.user();
    }
}
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h4>
<p>&#x8BBF;&#x95EE;&#xFF1A;<a href="http://localhost:8080/admin/hello" target="_blank">http://localhost:8080/admin/hello</a> &#x9700;&#x767B;&#x5F55;&#x76F8;&#x5E94;&#x89D2;&#x8272;&#x540E;&#x6709;&#x8BBF;&#x95EE;&#x76F8;&#x5E94;&#x65B9;&#x6CD5;&#x7684;&#x6743;&#x9650;</p>
<h2 id="102-&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BA4;&#x8BC1;">10.2 &#x57FA;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BA4;&#x8BC1;</h2>
<h3 id="&#x8BBE;&#x8BA1;&#x6570;&#x636E;&#x8868;">&#x8BBE;&#x8BA1;&#x6570;&#x636E;&#x8868;</h3>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user`</span> (
    <span class="hljs-string">`id`</span> <span class="hljs-built_in">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`username`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&apos;&apos;</span>,
    <span class="hljs-string">`password`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&apos;&apos;</span>,
    <span class="hljs-string">`enabled`</span> TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
    <span class="hljs-string">`locked`</span> TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
)
<span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&apos;&#x7528;&#x6237;&#x8868;&apos;</span>
<span class="hljs-keyword">COLLATE</span>=<span class="hljs-string">&apos;utf8mb4_unicode_ci&apos;</span>
;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> (
    <span class="hljs-string">`id`</span> <span class="hljs-built_in">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`uid`</span> <span class="hljs-built_in">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`rid`</span> <span class="hljs-built_in">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
)
<span class="hljs-keyword">COLLATE</span>=<span class="hljs-string">&apos;utf8mb4_unicode_ci&apos;</span>
;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role`</span> (
    <span class="hljs-string">`id`</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`name`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&apos;&apos;</span>,
    <span class="hljs-string">`nameZh`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&apos;&apos;</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
)
<span class="hljs-keyword">COLLATE</span>=<span class="hljs-string">&apos;utf8mb4_unicode_ci&apos;</span>
;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;root&apos;</span>, <span class="hljs-string">&apos;$2a$10$XIEXPUVI7KO7BHhcouwOkuGdGMCxrLeP3/4uquolM9.O81hpy7FUK&apos;</span>, <span class="hljs-string">&apos;q&apos;</span>);
<span class="hljs-comment">/* SQL&#x9519;&#x8BEF;&#xFF08;1366&#xFF09;&#xFF1A;Incorrect integer value: &apos;q&apos; for column &apos;enabled&apos; at row 1 */</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;root&apos;</span>, <span class="hljs-string">&apos;$2a$10$XIEXPUVI7KO7BHhcouwOkuGdGMCxrLeP3/4uquolM9.O81hpy7FUK&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>, <span class="hljs-string">`locked`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">1</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;2&apos;</span>, <span class="hljs-string">&apos;admin&apos;</span>, <span class="hljs-string">&apos;$2a$10$G/nzb3czQABEZy4HgEN7pu8KCRNgM076KGpsB7mU6nvdLnyEcPO.S&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>, <span class="hljs-string">`locked`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">2</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;3&apos;</span>, <span class="hljs-string">&apos;ihao&apos;</span>, <span class="hljs-string">&apos;$2a$10$dRtaxlvje3y9rM40uHpFzeTVD/Ivaae6BMgTTxuYoiD35m16BSpx2&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>, <span class="hljs-string">`enabled`</span>, <span class="hljs-string">`locked`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">3</span>;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;ROLE_dba&apos;</span>, <span class="hljs-string">&apos;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x5458;&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">1</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;2&apos;</span>, <span class="hljs-string">&apos;ROLE_admin&apos;</span>, <span class="hljs-string">&apos;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5458;&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">2</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;3&apos;</span>, <span class="hljs-string">&apos;ROLE_user&apos;</span>, <span class="hljs-string">&apos;&#x7528;&#x6237;&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">3</span>;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">1</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;2&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;2&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">2</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;3&apos;</span>, <span class="hljs-string">&apos;2&apos;</span>, <span class="hljs-string">&apos;2&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">3</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;4&apos;</span>, <span class="hljs-string">&apos;3&apos;</span>, <span class="hljs-string">&apos;3&apos;</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">`study`</span>.<span class="hljs-string">`user_role`</span> <span class="hljs-keyword">WHERE</span>  <span class="hljs-string">`id`</span>=<span class="hljs-number">4</span>;
</code></pre>
<h3 id="&#x521B;&#x5EFA;&#x9879;&#x76EE;">&#x521B;&#x5EFA;&#x9879;&#x76EE;</h3>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 id="&#x914D;&#x7F6E;&#x6570;&#x636E;&#x5E93;">&#x914D;&#x7F6E;&#x6570;&#x636E;&#x5E93;</h3>
<pre><code class="lang-properties">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.url=jdbc:mysql://59.78.194.153:3306/study?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Hongkong
spring.datasource.username=root
spring.datasource.password=123456
</code></pre>
<h3 id="&#x5B9E;&#x4F53;&#x7C7B;">&#x5B9E;&#x4F53;&#x7C7B;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span> </span>{
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String nameZh;
    <span class="hljs-comment">// getter setter </span>
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>{
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> Boolean enabled;
    <span class="hljs-keyword">private</span> Boolean locked;
    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">for</span> (Role role : roles) {
            authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName()));
        }
        <span class="hljs-keyword">return</span> authorities;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> !locked;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> enabled;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>{
        <span class="hljs-keyword">this</span>.id = id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getRoles</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> roles;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRoles</span><span class="hljs-params">(List&lt;Role&gt; roles)</span> </span>{
        <span class="hljs-keyword">this</span>.roles = roles;
    }
    <span class="hljs-comment">// toString() {</span>

}
</code></pre>
<h3 id="&#x521B;&#x5EFA;service">&#x521B;&#x5EFA;Service</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    UserMapper userMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>{
        User user = userMapper.loadUserByUsername(username);
        System.out.println(<span class="hljs-string">&quot;user:&quot;</span> + user);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;&#x8D26;&#x6237;&#x4E0D;&#x5B58;&#x5728;&quot;</span>);
        }
        user.setRoles(userMapper.getUserRolesByUid(user.getId()));
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<h3 id="dao&#x5C42;">Dao&#x5C42;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>{
    <span class="hljs-function">User <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span></span>;

    <span class="hljs-function">List&lt;Role&gt; <span class="hljs-title">getUserRolesByUid</span><span class="hljs-params">(Integer id)</span></span>;
}
</code></pre>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;top.huzhenhao.chapter10.dao.UserMapper&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadUserByUsername&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;top.huzhenhao.chapter10.pojo.User&quot;</span>&gt;</span>
        select * from user where username=#{username}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserRolesByUid&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;top.huzhenhao.chapter10.pojo.Role&quot;</span>&gt;</span>
        select * from role r, user_role ur where r.id=ur.id and ur.id=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h3 id="&#x914D;&#x7F6E;-spring-security">&#x914D;&#x7F6E; Spring Security</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    UserService userService;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">10</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.userDetailsService(userService);
    }
}
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h3>
<p>controller &#x5C42;&#x540C;&#x524D;</p>
<h2 id="104-oauth">10.4 OAuth</h2>
<h3 id="&#x4F9D;&#x8D56;">&#x4F9D;&#x8D56;</h3>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.lettuce<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lettuce-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security.oauth<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-oauth2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 id="&#x914D;&#x7F6E;-redis">&#x914D;&#x7F6E; Redis</h3>
<pre><code class="lang-properties"># REDIS (RedisProperties)
# Redis&#x6570;&#x636E;&#x5E93;&#x7D22;&#x5F15;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF09;
spring.redis.database=0
# Redis&#x670D;&#x52A1;&#x5668;&#x5730;&#x5740;
spring.redis.host=59.78.194.153
# Redis&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x7AEF;&#x53E3;
spring.redis.port=6378
# Redis&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x5BC6;&#x7801;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;&#x7A7A;&#xFF09;
spring.redis.password=1xx
# &#x8FDE;&#x63A5;&#x6C60;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#xFF08;&#x4F7F;&#x7528;&#x8D1F;&#x503C;&#x8868;&#x793A;&#x6CA1;&#x6709;&#x9650;&#x5236;&#xFF09;
spring.redis.pool.max-active=8
# &#x8FDE;&#x63A5;&#x6C60;&#x6700;&#x5927;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF08;&#x4F7F;&#x7528;&#x8D1F;&#x503C;&#x8868;&#x793A;&#x6CA1;&#x6709;&#x9650;&#x5236;&#xFF09;
spring.redis.pool.max-wait=-1
# &#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x7684;&#x6700;&#x5927;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;
spring.redis.pool.max-idle=8
# &#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x7684;&#x6700;&#x5C0F;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;
spring.redis.pool.min-idle=0
# &#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF08;&#x6BEB;&#x79D2;&#xFF09;
spring.redis.timeout=0
</code></pre>
<h3 id="&#x914D;&#x7F6E;&#x6388;&#x6743;&#x670D;&#x52A1;&#x5668;">&#x914D;&#x7F6E;&#x6388;&#x6743;&#x670D;&#x52A1;&#x5668;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAuthorizationServer</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthorizationServerConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizationServerConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    AuthenticationManager authenticationManager;
    <span class="hljs-meta">@Autowired</span>
    RedisConnectionFactory redisConnectionFactory;
    <span class="hljs-meta">@Autowired</span>
    UserDetailsService userDetailsService;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(ClientDetailsServiceConfigurer clients)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        clients.inMemory()
                .withClient(<span class="hljs-string">&quot;password&quot;</span>)
                .authorizedGrantTypes(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;refresh_token&quot;</span>)
                .accessTokenValiditySeconds(<span class="hljs-number">1800</span>)
                .resourceIds(<span class="hljs-string">&quot;rid&quot;</span>)
                .scopes(<span class="hljs-string">&quot;all&quot;</span>)
                .secret(<span class="hljs-string">&quot;$2a$10$dRtaxlvje3y9rM40uHpFzeTVD/Ivaae6BMgTTxuYoiD35m16BSpx2&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        endpoints.tokenStore(<span class="hljs-keyword">new</span> RedisTokenStore(redisConnectionFactory))
                .authenticationManager(authenticationManager)
                .userDetailsService(userDetailsService);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthorizationServerSecurityConfigurer security)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        security.allowFormAuthenticationForClients();
    }
}
</code></pre>
<h3 id="&#x914D;&#x7F6E;&#x8D44;&#x6E90;&#x670D;&#x52A1;&#x5668;">&#x914D;&#x7F6E;&#x8D44;&#x6E90;&#x670D;&#x52A1;&#x5668;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableResourceServer</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceServerConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResourceServerConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(ResourceServerSecurityConfigurer resources)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        resources.resourceId(<span class="hljs-string">&quot;rid&quot;</span>).stateless(<span class="hljs-keyword">true</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        http.authorizeRequests()
                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)
                .anyRequest().authenticated();
    }
}
</code></pre>
<p>&#xB7;</p>
<h3 id="&#x914D;&#x7F6E;-security">&#x914D;&#x7F6E; Security</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-meta">@Bean</span>(name = BeanIds.AUTHENTICATION_MANAGER)
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AuthenticationManager <span class="hljs-title">authenticationManagerBean</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.authenticationManagerBean();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> UserDetailsService <span class="hljs-title">userDetailsService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.userDetailsService();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.inMemoryAuthentication()
                .withUser(<span class="hljs-string">&quot;admin&quot;</span>)
                .password(<span class="hljs-string">&quot;$2a$10$dRtaxlvje3y9rM40uHpFzeTVD/Ivaae6BMgTTxuYoiD35m16BSpx2&quot;</span>)
                .roles(<span class="hljs-string">&quot;admin&quot;</span>)
                .and()
                .withUser(<span class="hljs-string">&quot;ihao&quot;</span>)
                .password(<span class="hljs-string">&quot;$2a$10$dRtaxlvje3y9rM40uHpFzeTVD/Ivaae6BMgTTxuYoiD35m16BSpx2&quot;</span>)
                .roles(<span class="hljs-string">&quot;user&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        http.antMatcher(<span class="hljs-string">&quot;/oauth/**&quot;</span>).authorizeRequests()
                .antMatchers(<span class="hljs-string">&quot;/oauth/**&quot;</span>).permitAll()
                .and().csrf().disable();
    }
}
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;&#x9A8C;&#x8BC1;">&#x6D4B;&#x8BD5;&#x9A8C;&#x8BC1;</h3>
<p>post: <a href="http://localhost:8080/oauth/token?username=ihao&amp;password=123456&amp;grant_type=password&amp;client_id=password&amp;scope=all&amp;client_secret=123456" target="_blank">http://localhost:8080/oauth/token?username=ihao&amp;password=123456&amp;grant_type=password&amp;client_id=password&amp;scope=all&amp;client_secret=123456</a></p>
<pre><code>{
    &quot;access_token&quot;: &quot;518b32ac-6e46-4387-a3c5-467a47e28745&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;refresh_token&quot;: &quot;cefc0a87-7349-48cb-ace5-a7a7ab19581e&quot;,
    &quot;expires_in&quot;: 1799,
    &quot;scope&quot;: &quot;all&quot;
}
</code></pre><p>post: <a href="http://localhost:8080/oauth/token?username=ihao&amp;password=123456&amp;grant_type=refresh_token&amp;refresh_token=cefc0a87-7349-48cb-ace5-a7a7ab19581e&amp;client_id=password&amp;scope=all&amp;client_secret=123456" target="_blank">http://localhost:8080/oauth/token?username=ihao&amp;password=123456&amp;grant_type=refresh_token&amp;refresh_token=cefc0a87-7349-48cb-ace5-a7a7ab19581e&amp;client_id=password&amp;scope=all&amp;client_secret=123456</a></p>
<pre><code>{
    &quot;access_token&quot;: &quot;bd00cf8b-0ad9-445e-92f5-1176b5fd8636&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;refresh_token&quot;: &quot;cefc0a87-7349-48cb-ace5-a7a7ab19581e&quot;,
    &quot;expires_in&quot;: 1799,
    &quot;scope&quot;: &quot;all&quot;
}
</code></pre><p>get: <a href="http://localhost:8080/user/hello?access_token=bd00cf8b-0ad9-445e-92f5-1176b5fd8636" target="_blank">http://localhost:8080/user/hello?access_token=bd00cf8b-0ad9-445e-92f5-1176b5fd8636</a></p>
<pre><code>Hello user
</code></pre><p>get: <a href="http://localhost:8080/admin/hello?access_token=bd00cf8b-0ad9-445e-92f5-1176b5fd8636" target="_blank">http://localhost:8080/admin/hello?access_token=bd00cf8b-0ad9-445e-92f5-1176b5fd8636</a></p>
<pre><code>{
    &quot;error&quot;: &quot;access_denied&quot;,
    &quot;error_description&quot;: &quot;Access is denied&quot;
}
</code></pre><p>reids&#xFF1A;</p>
<p><img src="chapter10/image-20201216095908439.png" alt="image-20201216095908439"></p>
<h2 id="105-&#x6574;&#x5408;-shiro">10.5 &#x6574;&#x5408; Shiro</h2>
<h3 id="&#x4F9D;&#x8D56;">&#x4F9D;&#x8D56;</h3>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 id="&#x914D;&#x7F6E;">&#x914D;&#x7F6E;</h3>
<p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<pre><code class="lang-properties">shiro.enabled=true
shiro.web.enabled=true
shiro.loginUrl=/login
shiro.successUrl=/index
shiro.unauthorizedUrl=/unauthorized
shiro.sessionManager.sessionIdUrlRewritingEnabled=true
shiro.sessionManager.sessionIdCookieEnabled=true
</code></pre>
<p>&#x914D;&#x7F6E;Shiro</p>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Realm <span class="hljs-title">realm</span><span class="hljs-params">()</span> </span>{
        TextConfigurationRealm realm = <span class="hljs-keyword">new</span> TextConfigurationRealm();
        realm.setUserDefinitions(<span class="hljs-string">&quot;ihao=123456,user\n admin=123456,admin&quot;</span>); <span class="hljs-comment">//&#x6DFB;&#x52A0;&#x7528;&#x6237;&#x540D;+&#x5BC6;&#x7801;+&#x89D2;&#x8272;</span>
        realm.setRoleDefinitions(<span class="hljs-string">&quot;admin=read,write\n user=read&quot;</span>); <span class="hljs-comment">//&#x6DFB;&#x52A0;&#x6743;&#x9650;</span>
        <span class="hljs-keyword">return</span> realm;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterChainDefinition <span class="hljs-title">shiroFilterChainDefinition</span><span class="hljs-params">()</span> </span>{
        DefaultShiroFilterChainDefinition chainDefinition = <span class="hljs-keyword">new</span> DefaultShiroFilterChainDefinition();
        chainDefinition.addPathDefinition(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);
        chainDefinition.addPathDefinition(<span class="hljs-string">&quot;/doLogin&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);
        chainDefinition.addPathDefinition(<span class="hljs-string">&quot;/logout&quot;</span>, <span class="hljs-string">&quot;logout&quot;</span>);
        chainDefinition.addPathDefinition(<span class="hljs-string">&quot;/**&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);
        <span class="hljs-keyword">return</span> chainDefinition;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroDialect <span class="hljs-title">shiroDialect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ShiroDialect();
    }
}
</code></pre>
<p>&#x4E0D;&#x9700;&#x8981;&#x89D2;&#x8272;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x914D;&#x7F6E;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>{
        registry.addViewController(<span class="hljs-string">&quot;/login&quot;</span>).setViewName(<span class="hljs-string">&quot;login&quot;</span>);
        registry.addViewController(<span class="hljs-string">&quot;/index&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);
        registry.addViewController(<span class="hljs-string">&quot;/unauthorized&quot;</span>).setViewName(<span class="hljs-string">&quot;unauthorized&quot;</span>);
    }
}
</code></pre>
<p>&#x914D;&#x7F6E;&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x5904;&#x7406;</p>
<pre><code class="lang-java"><span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionController</span> </span>{
    <span class="hljs-meta">@ExceptionHandler</span>(AuthorizationException.class)
    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">error</span><span class="hljs-params">(AuthorizationException e)</span> </span>{
        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;unauthorized&quot;</span>);
        mv.addObject(<span class="hljs-string">&quot;error&quot;</span>, e.getMessage());
        <span class="hljs-keyword">return</span> mv;
    }
}
</code></pre>
<h3 id="&#x63A7;&#x5236;&#x5C42;">&#x63A7;&#x5236;&#x5C42;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/doLogin&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(String username, String passwd, Model model)</span> </span>{
        <span class="hljs-comment">// &#x8BB0;&#x4E00;&#x4E2A;&#x5C0F;&#x5751;&#xFF1A;</span>
        <span class="hljs-comment">// username &#x548C; passwd &#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x63A5;&#x53D7;&#x7684;&#x662F;&#x6765;&#x81EA;login.html &#x4E2D;&#x7684; input &#x6807;&#x7B7E;&#x5185;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x540D;&#x5B57;&#x9700;&#x8981;&#x5BF9;&#x5E94;</span>
        <span class="hljs-comment">// &#x4E4B;&#x524D;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570;&#x540D;&#x4E3A; passwd login&#x91CC;&#x63D0;&#x4EA4;&#x7684;&#x662F;password &#x5BB3;&#x7684;&#x5BC6;&#x7801;&#x4E00;&#x76F4;&#x9A8C;&#x8BC1;&#x51FA;&#x9519;</span>
        System.out.println(<span class="hljs-string">&quot;username:&quot;</span> + username);
        System.out.println(<span class="hljs-string">&quot;passwd:&quot;</span> + passwd); 
        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(username, passwd);
        Subject subject = SecurityUtils.getSubject();
        <span class="hljs-keyword">try</span> {
            subject.login(token);
        } <span class="hljs-keyword">catch</span> (AuthenticationException e) {
            model.addAttribute(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;&#x7528;&#x6237;&#x540D;&#x6216;&#x5BC6;&#x7801;&#x9519;&#x8BEF;&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/index&quot;</span>;
    }

    <span class="hljs-meta">@RequiresRoles</span>(<span class="hljs-string">&quot;admin&quot;</span>)
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/admin&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin&quot;</span>;
    }

    <span class="hljs-meta">@RequiresRoles</span>(value = {<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>}, logical = Logical.OR)
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/user&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user&quot;</span>;
    }
}
</code></pre>
<h3 id="&#x6DFB;&#x52A0;&#x4E94;&#x4E2A;html&#x9875;&#x9762;">&#x6DFB;&#x52A0;&#x4E94;&#x4E2A;HTML&#x9875;&#x9762;</h3>
<p><img src="chapter10/image-20201216095416311.png" alt="image-20201216095416311"></p>
<p>index.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:shiro</span>=<span class="hljs-string">&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Hello, <span class="hljs-tag">&lt;<span class="hljs-name">shiro:principal</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/logout&quot;</span>&gt;</span>&#x6CE8;&#x9500;&#x767B;&#x5F55;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">shiro:hasRole</span>=<span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/admin&quot;</span>&gt;</span>&#x7BA1;&#x7406;&#x5458;&#x9875;&#x9762;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">shiro:hasAllRoles</span>=<span class="hljs-string">&quot;admin,user&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/user&quot;</span>&gt;</span>&#x666E;&#x901A;&#x7528;&#x6237;&#x9875;&#x9762;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>login.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/doLogin&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;passwd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;${error}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#x767B;&#x5F55;&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>user.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x666E;&#x901A;&#x7528;&#x6237;&#x754C;&#x9762;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>admin.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x7BA1;&#x7406;&#x5458;&#x754C;&#x9762;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>unauthorized.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#x672A;&#x83B7;&#x6388;&#x6743;&#xFF0C;&#x975E;&#x6CD5;&#x8BBF;&#x95EE;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;${error}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h3>
<p><img src="chapter10/image-20201216094715312.png" alt="image-20201216094715312"></p>
<p><img src="chapter10/image-20201216094729618.png" alt="image-20201216094729618"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chapter09.html" class="navigation navigation-prev " aria-label="Previous page: Chapter09">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="chapter11.html" class="navigation navigation-next " aria-label="Next page: Chapter11">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Chapter10","level":"1.5.2.10","depth":3,"next":{"title":"Chapter11","level":"1.5.2.11","depth":3,"path":"Java/SpringBoot+Vue开发实战笔记/chapter11.md","ref":"Java/SpringBoot+Vue开发实战笔记/chapter11.md","articles":[]},"previous":{"title":"Chapter09","level":"1.5.2.9","depth":3,"path":"Java/SpringBoot+Vue开发实战笔记/chapter09.md","ref":"Java/SpringBoot+Vue开发实战笔记/chapter09.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","intopic-toc","code","hide-element","splitter","back-to-top-button","-lunr","-search","search-pro","advanced-emoji"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"intopic-toc":{"isCollapsed":true,"isScrollspyActive":true,"label":{"de":"In diesem Artikel","en":"In this article","zh-hans":"本文目录"},"maxDepth":4,"mode":"nested","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true},"splitter":{},"search-pro":{},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"advanced-emoji":{"embedEmojis":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"胡朕豪","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"我的代码手册","language":"zh-hans","gitbook":"*"},"file":{"path":"Java/SpringBoot+Vue开发实战笔记/chapter10.md","mtime":"2021-02-07T02:29:48.789Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-02-07T02:30:39.008Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/gumshoe.polyfills.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

